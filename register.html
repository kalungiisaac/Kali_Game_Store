<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - KALI Game Store</title>
    <meta
      name="description"
      content="Create an account or login to KALI Game Store. Manage your wishlist, explore games, and save your favorite titles."
    />
    <meta property="og:title" content="Register - KALI Game Store" />
    <meta
      property="og:description"
      content="Create an account or login to KALI Game Store. Manage your wishlist and explore games."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://kali-game-store.com/register.html" />
    <meta property="og:site_name" content="KALI Game Store" />
    <meta property="twitter:card" content="summary_large_image" />
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==" />
    <link rel="stylesheet" href="css/responsive.css" />
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <header class="header"></header>

    <main class="register-page">
      <div class="register-container">
        <div class="register-card">
          <div class="register-tabs">
            <button class="register-tab-btn active" data-tab="register">
              Create Account
            </button>
            <button class="register-tab-btn" data-tab="login">Login</button>
          </div>

          <!-- Register Tab -->
          <form class="register-tab-content active" id="register-tab" data-tab="register">
            <h2>Sign Up</h2>
            <p class="tab-description">
              Create a new account to start building your game library
            </p>

            <div class="form-group">
              <label for="page-reg-username">Username:</label>
              <input
                type="text"
                id="page-reg-username"
                placeholder="Choose a username"
                required
              />
            </div>

            <div class="form-group">
              <label for="page-reg-email">Email:</label>
              <input
                type="email"
                id="page-reg-email"
                placeholder="Enter your email"
                required
              />
            </div>

            <div class="form-group">
              <label for="page-reg-password">Password:</label>
              <input
                type="password"
                id="page-reg-password"
                placeholder="At least 6 characters"
                required
              />
            </div>

            <div class="form-group">
              <label for="page-reg-confirm-password">Confirm Password:</label>
              <input
                type="password"
                id="page-reg-confirm-password"
                placeholder="Confirm password"
                required
              />
            </div>

            <div class="form-message" id="page-reg-message"></div>
            <button type="submit" class="btn btn-primary btn-block">
              Create Account
            </button>
          </form>

          <!-- Login Tab -->
          <form class="register-tab-content" id="login-tab" data-tab="login">
            <h2>Login</h2>
            <p class="tab-description">
              Sign in to access your account and wishlist
            </p>

            <div class="form-group">
              <label for="page-login-username">Username:</label>
              <input
                type="text"
                id="page-login-username"
                placeholder="Enter your username"
                required
              />
            </div>

            <div class="form-group">
              <label for="page-login-password">Password:</label>
              <input
                type="password"
                id="page-login-password"
                placeholder="Enter your password"
                required
              />
            </div>

            <div class="form-message" id="page-login-message"></div>
            <button type="submit" class="btn btn-primary btn-block">
              Login
            </button>
          </form>
        </div>
      </div>
    </main>

    <footer class="footer"></footer>

    <div id="register-modal" class="register-modal"></div>

    <script type="module">
      import { header } from './js/header.js';
      import { footer } from './js/footer.js';
      import { register } from './js/register.js';

      // Render header and footer
      new header();
      new footer();
      new register();
      const registerInstance = new register();
      registerInstance.init();

      // Handle page-level forms
      const registerForm = document.querySelector('#register-tab');
      const loginForm = document.querySelector('#login-tab');
      const tabs = document.querySelectorAll('.register-tab-btn');

      // Tab switching
      tabs.forEach((btn) => {
        btn.addEventListener('click', (e) => {
          const tab = e.target.dataset.tab;
          document.querySelectorAll('.register-tab-content').forEach((form) => {
            form.classList.remove('active');
          });
          document.querySelectorAll('.register-tab-btn').forEach((b) => {
            b.classList.remove('active');
          });
          document.querySelector(`#${tab}-tab`).classList.add('active');
          e.target.classList.add('active');
        });
      });

      // Register form submit
      registerForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.querySelector('#page-reg-username').value;
        const email = document.querySelector('#page-reg-email').value;
        const password = document.querySelector('#page-reg-password').value;
        const confirmPassword = document.querySelector('#page-reg-confirm-password').value;

        const result = registerInstance.register(username, email, password, confirmPassword);
        const messageEl = document.querySelector('#page-reg-message');

        messageEl.textContent = result.message;
        messageEl.className = result.success
          ? 'form-message success'
          : 'form-message error';

        if (result.success) {
          registerForm.reset();
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1500);
        }
      });

      // Login form submit
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.querySelector('#page-login-username').value;
        const password = document.querySelector('#page-login-password').value;

        const result = registerInstance.login(username, password);
        const messageEl = document.querySelector('#page-login-message');

        messageEl.textContent = result.message;
        messageEl.className = result.success
          ? 'form-message success'
          : 'form-message error';

        if (result.success) {
          loginForm.reset();
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1500);
        }
      });
    </script>
  </body>
</html>
